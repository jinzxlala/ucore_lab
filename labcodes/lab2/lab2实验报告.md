#lab2 实验报告
靳子翔  2012011365 计25

##练习0
将lab1中的trap.c和kdebug.c中的代码粘贴到了lab2中对应的位置。（并没有使用eclipse的merge功能）

##练习一  实现 first-fit 连续物理内存分配算法
实现过程：根据最相匹配算法，在alloc的时候，但找到的第一个块有多余的空间，那么需要把这个块切开，在这之后，将其property位设为1,将其link加入原先块的link后面，再删去自己原来的link。在free时，首先找到要free的块的位置，然后进行合并。合并的过程为：如果该块的前面或者后面有相邻的块，那么进行合并，并将位置靠后的块的property设为0,删除其link，更新较前块的property和link。由于每次只需要看之前和之后的块，所以不需要遍历链表。

改进：由于该算法的时间花费主要集中在查找第一个比n大的空闲块，以及寻找第一个page地址比base大的块，故可以用线段树来维护，这样的查找复杂度可以降至o(logn)

与参考答案的不同：参考答案中在alloc时维护了每一个页的reverse和property，这样显然比按块维护要慢，但是出错率更低。

##练习二 实现寻找虚拟地址对应的页表项
实现过程：根据注释中的提示：对于目前得到的一级页表的对应项，首先检查其有效性，如果无效则需要新建一个页面再返回二级页表项。在新建时，首先申请一个页面，失败时返回空指针，之后重置该页面，返回页面目录项指向的二级页表。之后填入起始地址和权限位。

PDE中包含二级页表的表基地址，三个权限位：有效、可写、可被用户访问。PTE中包含对应页的物理地址，两个权限位：是否有效，是否可写。权限位用来判断页是否存在，管理内存和保护数据。

硬件要向硬盘发出信号，并在内存和硬盘之间进行数据交换。

##练习三 释放某虚地址所在的页并取消对应二级页表项的映射
实现过程：根据注释中的提示，首先判断二级页表是否有效，无效则退出。之后将该页的引用次数减一，如果引用次数变为0,则释放该页。之后将二级页表清零，刷新一下TLB。

有对应关系。页表是从end开始在连续一段内存中存放的。

让gcc编译出的虚拟起始地址从0x100000开始。

##OS原理中很重要但并没有在实验中对应的知识点：
只是实现了二级页表的访问和删除，并没有处理缺页的情况。

