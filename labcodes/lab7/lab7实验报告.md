#lab7实验报告
##靳子翔 2012011365 计25

##练习一  理解内核级信号量的实现和基于内核级信号量的哲学家就餐问题
回答问题：
1.内核级信号量semaphore构成为：一个变量value,代表剩余的资源数；waitqueue,表示等待队列；
函数有：
（1）down函数，当一个线程请求资源时调用，具体过程则是由__down函数来进行。如果value大于0那么就直接获得相应资源并且返回。否则将该进程放入等待队列中，进入sleep状态，并调用schedule()函数调度其他线程。
（2）up函数，当线程释放资源时调用此函数。具体过程由 __up函数来执行。如果等待队列为空，那么让value增加（即没有线程在等待资源时让其变为空闲资源）。否则唤醒一个等待队列中的线程。
2.用户态进程/线程提供信号量机制
对调度的调整必须在内核态中进行，所以增加系统调用sys_sem,sys_up,sys_down用来新建信号量、释放资源、申请资源。然后在中断处理中调用三个内核态函数即可。

##练习二  完成内核级条件变量和基于内核级条件变量的哲学家就餐问题
实现过程：
条件变量中，value表示等待线程数，waitqueue表示等待队列。管程中有一个mutex表示进入管程的信号量，next表示等待使用管程的线程，nextcount表示等待使用管程的线程数。
在实现哲学家就餐问题中，在申请叉子（资源）时，如果发现条件不能满足，那么进入等待状态（相邻人都不在吃）。释放叉子时，首先将自己的叉子释放，然后试图唤醒相邻的人（线程）。如果可以唤醒那么让其醒，结束其申请过程。
>
ps:不知道为啥priority始终无法通过……放弃治疗了……

